<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>El Sabor Dobla'O - Pedidos Online</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="propertie.png">
    <link rel="shortcut icon" type="image/png" href="propertie.png">
    <link rel="apple-touch-icon" href="propertie.png">
    
    <!-- Preconnect y DNS Prefetch para optimizar carga -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- Preload del logo crÃ­tico -->
    <link rel="preload" as="image" href="propertie.png">
    
    <!-- Fuentes con display=swap para evitar bloqueo -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Meta tags -->
    <meta name="theme-color" content="#ff8c00">
    <meta name="description" content="Ordena las mejores dobladas guatemaltecas. Entrega rÃ¡pida en zonas 1, 5, 9, 10, 15 y 16.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <style>
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* Prevenir flash de contenido sin estilo */
        body {
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }
        
        body.loaded {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo-nav">
                <img src="propertie.png" alt="El Sabor Dobla'O" class="nav-logo" width="50" height="38" loading="eager">
            </div>
            <button class="menu-toggle" id="menuToggle" aria-label="MenÃº">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="#menu-section">ğŸ´ MenÃº</a></li>
                <li><a href="#ubicacion-section">ğŸ“ UbicaciÃ³n</a></li>
                <li><a href="#contacto-section">ğŸ“ Contacto</a></li>
            </ul>
        </div>
    </nav>

    <!-- HERO COMPACTO -->
    <header class="hero">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <img src="propertie.png" alt="El Sabor Dobla'O Logo" class="hero-logo" width="80" height="65" loading="eager">
            <h1>El Sabor Dobla'O</h1>
            <p class="hero-subtitle">âœ¨ AutÃ©ntico sabor guatemalteco</p>
            <div class="hero-cta">
                <a href="#menu-section" class="btn-hero">
                    ğŸ´ Ver MenÃº Completo
                </a>
            </div>
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="container">
        <!-- SECCIÃ“N DE MENÃš -->
        <section id="menu-section" class="order-section">
            <div class="section">
                <div class="section-title">
                    <span class="section-icon">ğŸ´</span>
                    <h2>Nuestro MenÃº</h2>
                </div>
                <div id="menuContainer">
                    <!-- El menÃº se cargarÃ¡ dinÃ¡micamente -->
                </div>
            </div>
        </section>
    </div>

    <!-- CARRITO FIJO -->
    <div class="cart-summary">
        <div class="cart-content">
            <div class="cart-info">
                <div class="cart-items" id="cartItemsCount">ğŸ›’ Tu carrito estÃ¡ vacÃ­o</div>
                <div class="cart-total">Total: <span id="cartTotal">Q0</span></div>
            </div>
            <button class="whatsapp-btn" onclick="openCheckout()" disabled id="whatsappBtn">
                <span>ğŸ›’</span>
                <span>Continuar</span>
            </button>
        </div>
    </div>

    <!-- MODAL DE COMBO -->
    <div id="comboModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ½ï¸ Personaliza tu Combo</h3>
            <div id="comboConfig"></div>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeModal()">âŒ Cancelar</button>
                <button class="btn-save" onclick="saveCombo()">âœ… Agregar</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE CHECKOUT -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content modal-checkout">
            <h3>ğŸ“‹ Completa tu Pedido</h3>
            
            <!-- Resumen del pedido -->
            <div class="checkout-summary">
                <h4>ğŸ“¦ Tu Orden:</h4>
                <div id="checkoutOrderSummary" class="checkout-order-list"></div>
                <div class="checkout-total">
                    <strong>Total:</strong> <span id="checkoutTotal">Q0</span>
                </div>
            </div>

            <!-- Formulario de datos -->
            <form id="customerForm" class="checkout-form">
                <div class="form-group">
                    <label for="customerName">ğŸ‘¤ Nombre completo *</label>
                    <input type="text" id="customerName" placeholder="Juan PÃ©rez" required autocomplete="name">
                </div>
                
                <div class="form-group">
                    <label for="customerPhone">ğŸ“± TelÃ©fono * (8 dÃ­gitos)</label>
                    <input type="tel" id="customerPhone" required maxlength="8" pattern="[0-9]{8}" placeholder="12345678" autocomplete="tel">
                </div>
                
                <div class="form-group">
                    <label for="customerZone">ğŸ“ Zona de Entrega *</label>
                    <select id="customerZone" required>
                        <option value="">Selecciona tu zona</option>
                        <option value="Zona 1">Zona 1 - Q25 envÃ­o</option>
                        <option value="Zona 5">Zona 5 - Q25 envÃ­o</option>
                        <option value="Zona 9">Zona 9 - Q25 envÃ­o</option>
                        <option value="Zona 10">Zona 10 - Q25 envÃ­o</option>
                        <option value="Zona 15">Zona 15 - Q20 envÃ­o</option>
                        <option value="Zona 16">Zona 16 - Q15 envÃ­o</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="customerAddress">ğŸ  DirecciÃ³n completa *</label>
                    <textarea id="customerAddress" rows="2" required placeholder="Ej: 5a avenida 10-20 zona 1, casa blanca con portÃ³n negro" autocomplete="street-address"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="paymentMethod">ğŸ’³ MÃ©todo de Pago *</label>
                    <select id="paymentMethod" required>
                        <option value="">Selecciona tu mÃ©todo de pago</option>
                        <option value="efectivo">ğŸ’µ Efectivo</option>
                        <option value="tarjeta">ğŸ’³ Tarjeta</option>
                        <option value="transferencia">ğŸ¦ Transferencia</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="deliveryTime">â° Tiempo de Entrega *</label>
                    <select id="deliveryTime" required>
                        <option value="">Selecciona tiempo de entrega</option>
                        <option value="hoy">ğŸšš Entrega HOY (30-45 min)</option>
                        <option value="hoy-hora">ğŸ“… Entrega HOY - Elegir Hora</option>
                        <option value="maÃ±ana">ğŸ“… Programar para MAÃ‘ANA</option>
                    </select>
                </div>
                
                <div class="form-group" id="horarioHoy" style="display: none;">
                    <label for="deliveryHourToday">ğŸ• Hora preferida para hoy *</label>
                    <select id="deliveryHourToday">
                        <option value="">Selecciona hora</option>
                        <option value="12:00-13:00">ğŸ•› 12:00 - 1:00 PM</option>
                        <option value="13:00-14:00">ğŸ• 1:00 - 2:00 PM</option>
                        <option value="14:00-15:00">ğŸ•‘ 2:00 - 3:00 PM</option>
                        <option value="15:00-16:00">ğŸ•’ 3:00 - 4:00 PM</option>
                        <option value="16:00-17:00">ğŸ•“ 4:00 - 5:00 PM</option>
                        <option value="17:00-18:00">ğŸ•” 5:00 - 6:00 PM</option>
                        <option value="18:00-19:00">ğŸ•• 6:00 - 7:00 PM</option>
                        <option value="19:00-20:00">ğŸ•– 7:00 - 8:00 PM</option>
                    </select>
                </div>
                
                <div class="form-group" id="horarioMaÃ±ana" style="display: none;">
                    <label for="deliveryHour">ğŸ• Hora preferida para maÃ±ana *</label>
                    <select id="deliveryHour">
                        <option value="">Selecciona hora</option>
                        <option value="10:00-11:00">ğŸ•™ 10:00 - 11:00 AM</option>
                        <option value="11:00-12:00">ğŸ•š 11:00 - 12:00 PM</option>
                        <option value="12:00-13:00">ğŸ•› 12:00 - 1:00 PM</option>
                        <option value="13:00-14:00">ğŸ• 1:00 - 2:00 PM</option>
                        <option value="14:00-15:00">ğŸ•‘ 2:00 - 3:00 PM</option>
                        <option value="15:00-16:00">ğŸ•’ 3:00 - 4:00 PM</option>
                        <option value="16:00-17:00">ğŸ•“ 4:00 - 5:00 PM</option>
                        <option value="17:00-18:00">ğŸ•” 5:00 - 6:00 PM</option>
                        <option value="18:00-19:00">ğŸ•• 6:00 - 7:00 PM</option>
                        <option value="19:00-20:00">ğŸ•– 7:00 - 8:00 PM</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="orderComments">ğŸ’¬ Comentarios Especiales</label>
                    <textarea id="orderComments" rows="2" placeholder="Ej: Sin cebolla, extra sal, etc."></textarea>
                </div>

                <!-- Factura -->
                <div class="form-group">
                    <div class="factura-toggle" onclick="toggleFactura()">
                        <span>ğŸ“„ Â¿Necesitas factura?</span> <span id="facturaArrow">â–¼</span>
                    </div>
                    <div id="facturaSection" style="display: none;">
                        <label for="facturaOption">FacturaciÃ³n:</label>
                        <select id="facturaOption">
                            <option value="no">No requiero factura</option>
                            <option value="cf">Consumidor Final (C/F)</option>
                            <option value="nit">Factura con NIT</option>
                        </select>
                        <div id="nitField" style="display: none; margin-top: 12px;">
                            <label for="customerNit">NIT:</label>
                            <input type="text" id="customerNit" maxlength="9" pattern="[0-9]{1,9}" placeholder="12345678">
                        </div>
                    </div>
                </div>
            </form>

            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeCheckout()">â¬…ï¸ Volver al MenÃº</button>
                <button class="btn-save btn-whatsapp" onclick="reviewOrder()">ğŸ“± Enviar Pedido</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE REVISIÃ“N FINAL -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ“‹ Confirmar Pedido</h3>
            <div class="order-review" id="orderReview"></div>
            <div class="order-total-section">
                <div class="order-total-line">
                    <span>ğŸ’° TOTAL A PAGAR:</span>
                    <span id="reviewTotal">Q0</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeReviewModal()">âœï¸ Editar</button>
                <button class="btn-save btn-whatsapp" onclick="sendToWhatsApp()">ğŸ“± Confirmar y Enviar</button>
            </div>
        </div>
    </div>

    <!-- FOOTER CON UBICACIÃ“N Y CONTACTO -->
    <footer class="footer" id="ubicacion-section">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ğŸ“ Nuestra UbicaciÃ³n</h3>
                    <p><strong>1 calle 11-91 zona 16</strong></p>
                    <p>Plaza Paseo AcatÃ¡n, sobre el Boulevard AcatÃ¡n</p>
                    <p>Local 2</p>
                    <div class="location-buttons">
                        <a href="https://maps.app.goo.gl/1uAKLqxbZ2wkrfGA8?g_st=ipc" target="_blank" rel="noopener" class="btn-location">
                            ğŸ—ºï¸ Abrir en Google Maps
                        </a>
                        <a href="https://waze.com/ul/h9fxejnq8m" target="_blank" rel="noopener" class="btn-location">
                            ğŸš— Abrir en Waze
                        </a>
                    </div>
                    <p style="margin-top: 12px; font-size: 0.875rem; opacity: 0.9;">
                        BÃºscanos como: <strong>"El Sabor Doblao"</strong>
                    </p>
                </div>
                
                <div class="footer-section" id="contacto-section">
                    <h3>ğŸ“ Contacto</h3>
                    <p>ğŸ“± WhatsApp: <a href="https://wa.me/50234827948" target="_blank" rel="noopener" class="contact-link">+502 3482-7948</a></p>
                    <p>ğŸ“§ Email: <a href="mailto:info@elsabordoblao.com" class="contact-link">info@elsabordoblao.com</a></p>
                </div>
                
                <div class="footer-section">
                    <h3>â° Horarios</h3>
                    <p><strong>Lunes a Domingo</strong></p>
                    <p>10:00 AM - 8:00 PM</p>
                    <p style="margin-top: 8px; font-size: 0.875rem; color: var(--primary-yellow);">
                        ğŸšš Entregas en Zonas 1, 5, 9, 10, 15 y 16
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 El Sabor Dobla'O. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="js/menu.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/order.js"></script>
    
    <script>
        // ============================================
        // SOLUCIÃ“N DEFINITIVA ANTI-LOADING INFINITO
        // ============================================
        
        // 1. Forzar que el body sea visible despuÃ©s de DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('loaded');
            console.log('DOM completamente cargado');
            
            // Manejar errores de imÃ¡genes
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                // Si la imagen falla, usar placeholder
                img.addEventListener('error', function() {
                    this.src = 'assets/images/products/placeholder.jpg';
                });
                
                // Timeout de 3 segundos para cada imagen
                setTimeout(() => {
                    if (!img.complete || img.naturalHeight === 0) {
                        img.src = 'assets/images/products/placeholder.jpg';
                    }
                }, 3000);
            });
        });
        
        // 2. Forzar detener loading despuÃ©s de window.load
        window.addEventListener('load', function() {
            console.log('PÃ¡gina completamente cargada');
            document.body.classList.add('loaded');
        });
        
        // 3. TIMEOUT MÃXIMO - Forzar completar despuÃ©s de 4 segundos
        setTimeout(function() {
            document.body.classList.add('loaded');
            
            // Detener cualquier recurso pendiente
            if (document.readyState !== 'complete') {
                try {
                    window.stop();
                } catch(e) {
                    // Algunos navegadores no permiten window.stop()
                    console.log('Carga forzada a completar');
                }
            }
        }, 4000);
        
        // ============================================
        // SCRIPTS DE NAVEGACIÃ“N
        // ============================================
        
        // Toggle menÃº mÃ³vil
        document.getElementById('menuToggle')?.addEventListener('click', function() {
            document.getElementById('navMenu')?.classList.toggle('active');
        });
        
        // Cerrar menÃº al hacer clic en un enlace
        document.querySelectorAll('.nav-menu a').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('navMenu')?.classList.remove('active');
            });
        });
        
        // Cerrar menÃº al hacer clic fuera
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('navMenu');
            const toggle = document.getElementById('menuToggle');
            if (nav && toggle && !nav.contains(event.target) && !toggle.contains(event.target)) {
                nav.classList.remove('active');
            }
        });
        
        // Smooth scroll para los enlaces del menÃº
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const offsetTop = target.offsetTop - 70;
                    window.scrollTo({
                        top: offsetTop,
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>
    <!-- AGREGAR ESTE SCRIPT AL FINAL DEL index.html, ANTES DE </body> -->
<!-- DESPUÃ‰S de los otros scripts (menu.js, cart.js, order.js) -->

<script>
// ============================================
// SISTEMA DE CARGA INTELIGENTE DE IMÃGENES
// ============================================

(function() {
    'use strict';
    
    // ConfiguraciÃ³n
    const CONFIG = {
        TIMEOUT: 5000,          // 5 segundos mÃ¡ximo por imagen
        RETRY_ATTEMPTS: 3,      // Reintentar 3 veces
        RETRY_DELAY: 1000,      // 1 segundo entre reintentos
        PLACEHOLDER: 'assets/images/products/placeholder.jpg'
    };
    
    // Cache de imÃ¡genes cargadas exitosamente
    const imageCache = new Set();
    
    // Contador de imÃ¡genes cargadas
    let loadedImages = 0;
    let totalImages = 0;
    
    /**
     * Cargar una imagen con reintentos
     */
    function loadImageWithRetry(img, src, attempts = 0) {
        return new Promise((resolve, reject) => {
            // Si ya estÃ¡ en cachÃ©, resolver inmediatamente
            if (imageCache.has(src)) {
                img.src = src;
                resolve(src);
                return;
            }
            
            const tempImg = new Image();
            const timeoutId = setTimeout(() => {
                tempImg.src = ''; // Cancelar carga
                
                if (attempts < CONFIG.RETRY_ATTEMPTS) {
                    console.log(`Reintentando imagen (${attempts + 1}/${CONFIG.RETRY_ATTEMPTS}):`, src);
                    setTimeout(() => {
                        loadImageWithRetry(img, src, attempts + 1)
                            .then(resolve)
                            .catch(reject);
                    }, CONFIG.RETRY_DELAY);
                } else {
                    console.warn('Imagen fallÃ³ despuÃ©s de reintentos:', src);
                    reject(new Error('Timeout'));
                }
            }, CONFIG.TIMEOUT);
            
            tempImg.onload = function() {
                clearTimeout(timeoutId);
                img.src = src;
                imageCache.add(src);
                loadedImages++;
                updateLoadingProgress();
                resolve(src);
            };
            
            tempImg.onerror = function() {
                clearTimeout(timeoutId);
                
                if (attempts < CONFIG.RETRY_ATTEMPTS) {
                    console.log(`Error de carga, reintentando (${attempts + 1}/${CONFIG.RETRY_ATTEMPTS}):`, src);
                    setTimeout(() => {
                        loadImageWithRetry(img, src, attempts + 1)
                            .then(resolve)
                            .catch(reject);
                    }, CONFIG.RETRY_DELAY);
                } else {
                    console.error('Imagen fallÃ³ completamente:', src);
                    reject(new Error('Load failed'));
                }
            };
            
            tempImg.src = src;
        });
    }
    
    /**
     * Actualizar progreso de carga
     */
    function updateLoadingProgress() {
        if (totalImages > 0) {
            const percentage = Math.round((loadedImages / totalImages) * 100);
            console.log(`ImÃ¡genes cargadas: ${loadedImages}/${totalImages} (${percentage}%)`);
        }
    }
    
    /**
     * Inicializar sistema de carga de imÃ¡genes
     */
    function initImageLoader() {
        // Esperar a que el DOM estÃ© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', processImages);
        } else {
            processImages();
        }
    }
    
    /**
     * Procesar todas las imÃ¡genes del documento
     */
    function processImages() {
        // Usar MutationObserver para detectar imÃ¡genes dinÃ¡micas
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1) { // ELEMENT_NODE
                        if (node.tagName === 'IMG') {
                            handleImage(node);
                        } else {
                            const images = node.querySelectorAll('img');
                            images.forEach(handleImage);
                        }
                    }
                });
            });
        });
        
        // Observar todo el documento
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        // Procesar imÃ¡genes ya existentes
        const existingImages = document.querySelectorAll('img');
        totalImages = existingImages.length;
        existingImages.forEach(handleImage);
    }
    
    /**
     * Manejar una imagen individual
     */
    function handleImage(img) {
        // Ignorar imÃ¡genes que no tienen src o data-src
        const originalSrc = img.getAttribute('src') || img.getAttribute('data-src');
        if (!originalSrc || originalSrc === CONFIG.PLACEHOLDER) {
            return;
        }
        
        // Si la imagen ya estÃ¡ cargada, no hacer nada
        if (img.complete && img.naturalHeight !== 0) {
            imageCache.add(originalSrc);
            return;
        }
        
        // Usar Intersection Observer para lazy loading
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const imgElement = entry.target;
                        const src = imgElement.getAttribute('data-src') || imgElement.getAttribute('src');
                        
                        // Mostrar placeholder mientras carga
                        if (imgElement.src !== CONFIG.PLACEHOLDER) {
                            imgElement.style.opacity = '0.5';
                        }
                        
                        loadImageWithRetry(imgElement, src)
                            .then(() => {
                                imgElement.style.opacity = '1';
                                imgElement.style.transition = 'opacity 0.3s ease-in';
                            })
                            .catch(() => {
                                imgElement.src = CONFIG.PLACEHOLDER;
                                imgElement.style.opacity = '1';
                                imgElement.alt = 'Imagen no disponible';
                            });
                        
                        observer.unobserve(imgElement);
                    }
                });
            }, {
                rootMargin: '50px' // Cargar 50px antes de que sea visible
            });
            
            imageObserver.observe(img);
        } else {
            // Fallback para navegadores sin Intersection Observer
            loadImageWithRetry(img, originalSrc)
                .catch(() => {
                    img.src = CONFIG.PLACEHOLDER;
                });
        }
    }
    
    // Inicializar cuando el script se cargue
    initImageLoader();
    
    // Precargar imÃ¡genes crÃ­ticas (logo, hero)
    const criticalImages = [
        'propertie.png'
    ];
    
    criticalImages.forEach(src => {
        const img = new Image();
        img.src = src;
    });
    
    // Limpiar cachÃ© cada 30 minutos para liberar memoria
    setInterval(() => {
        if (imageCache.size > 100) {
            console.log('Limpiando cachÃ© de imÃ¡genes...');
            imageCache.clear();
        }
    }, 30 * 60 * 1000);
    
})();

// ============================================
// SERVICE WORKER PARA CACHÃ‰ OFFLINE (OPCIONAL)
// ============================================

if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        // Registrar service worker solo en producciÃ³n
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('Service Worker registrado exitosamente:', registration.scope);
                })
                .catch(function(error) {
                    console.log('Error al registrar Service Worker:', error);
                });
        }
    });
}
</script>
</body>
</html>


